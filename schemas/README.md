# SSI Protocol Artifact Schemas

**Status:** Normative (Constitutional)  
**Version:** 1.0.0-invariant  
**Purpose:** Enable independent verification of SSI compliance

---

## Overview

This directory contains **JSON Schema** definitions for SSI Protocol artifacts. These schemas are **normative**—they define the canonical format for verification, compliance, and provenance artifacts that enable independent auditing without trusting the operator.

**Purpose:**  
Make **trust portable** through cryptographically verifiable artifacts. Third parties (auditors, regulators, customers) can verify SSI compliance using only these artifacts and public verification tools.

---

## Schemas

### 1. RPX Record Schema (`rpx-record.schema.json`)

**Purpose:** Canonical format for decision audit records as defined in [SPEC.md](../SPEC.md) §2.1 and [AUDIT.md](../AUDIT.md).

**Required Fields:**
- `record_id` — Unique identifier for the decision
- `timestamp` — ISO 8601 (UTC) timestamp of decision evaluation
- `previous_hash` — SHA-256 hash of previous record (chain link)
- `decision_type` — Constitutional decision classification (see [DECISIONS.md](../DECISIONS.md))
- `agent_id` — Identifier of autonomous agent
- `outcome` — Decision outcome: `ALLOW`, `DENY`, or `ESCALATE`
- `context_hash` — SHA-256 hash of decision context
- `policy_version` — Policy envelope version used
- `record_hash` — SHA-256 hash of this record's canonical form

**Canonical Form Rules:**
- Alphabetical key order (lexicographic)
- No whitespace in JSON serialization
- UTF-8 encoding
- Exclude `metadata` field from hash computation

**Hash Computation:**
```javascript
// Pseudocode
canonical_json = serialize_alphabetical(record, exclude=['metadata'])
record_hash = SHA256(canonical_json)
```

**Usage:**
- Every SSI decision MUST produce an RPX record conforming to this schema
- Records form a hash chain (each `previous_hash` links to prior record)
- Third parties can verify chain integrity by recomputing hashes

**Related Docs:**
- [SPEC.md](../SPEC.md) §2.1 (Every Decision Has a Record)
- [AUDIT.md](../AUDIT.md) §3 (Hash Chain Verification)

---

### 2. Chain Proof Schema (`chain-proof.schema.json`)

**Purpose:** Cryptographic proof of hash chain integrity for independent verification.

**Required Fields:**
- `chain_id` — Identifier of the hash chain
- `genesis_hash` — Hash of the first record (known initialization)
- `current_head` — Hash of most recent record
- `record_count` — Total records in chain
- `verification_timestamp` — When proof was generated
- `integrity_status` — `VALID`, `INVALID`, or `INCOMPLETE`

**Optional Fields:**
- `sample_records` — Subset of records for spot-check verification
- `tamper_evidence` — Details of detected tampering (if `INVALID`)
- `verifier_identity` — Who performed verification
- `verifier_signature` — Cryptographic attestation

**Usage:**
- Generated by `ssi-verify` CLI or equivalent tooling
- Enables third parties to verify chain integrity without accessing runtime
- Can be used for spot-check verification (sample records) or full chain verification

**Verification Methods:**
- `full-recompute` — Verify every record hash and chain link
- `spot-check` — Verify random sample of records
- `merkle-proof` — Verify using Merkle tree structure

**Related Docs:**
- [SPEC.md](../SPEC.md) §2.4 (Hash Chain Integrity is Verifiable)
- [AUDIT.md](../AUDIT.md) §4 (Independent Verification)

---

### 3. Verification Report Schema (`verification-report.schema.json`)

**Purpose:** Output format for `ssi-verify` CLI tool. What third-party auditors receive after verification.

**Required Fields:**
- `report_id` — Unique identifier for this report
- `report_timestamp` — When report was generated
- `chain_id` — Chain being verified
- `verification_scope` — Scope of verification (time range, sample size, method)
- `integrity_status` — `VALID`, `INVALID`, or `INCOMPLETE`
- `compliance_level` — `L1`, `L2`, `L3`, or `null` (non-compliant)

**Integrity Details:**
- `total_records` — Total records in chain
- `verified_records` — How many were verified
- `failed_records` — How many failed verification
- `chain_breaks` — Detected hash chain breaks

**Compliance Details:**
- `rpx_records_present` — All decisions have records (SPEC §2.1)
- `fail_closed_verified` — System denies on error (SPEC §2.2)
- `human_escalation_available` — Operator veto exists (SPEC §2.3)
- `hash_chain_intact` — Chain integrity verified (SPEC §2.4)
- `context_captured` — Decision context present (SPEC §2.5)

**Usage:**
- Generated after running `ssi-verify` on a system
- Provides detailed findings for auditors and regulators
- Can include cryptographic signature from verifier
- Forms basis for compliance assertions

**Related Docs:**
- [COMPLIANCE.md](../COMPLIANCE.md) (Three-tier compliance levels)
- [SPEC.md](../SPEC.md) §3 (Compliance Definition)

---

### 4. Compliance Assertion Schema (`compliance-assertion.schema.json`)

**Purpose:** Portable compliance badge for SSI systems. Enables trust claims backed by verification evidence.

**Required Fields:**
- `assertion_id` — Unique identifier for this assertion
- `issued_timestamp` — When assertion was issued
- `system_identifier` — System being certified
- `compliance_level` — `L1`, `L2`, or `L3`
- `validity_period` — Start and end dates for assertion validity
- `issuer` — Entity issuing the assertion (auditor, certification body)

**Evidence:**
- `verification_report_id` — Link to supporting verification report
- `verification_report_url` — Where report can be accessed
- `chain_proof_hash` — Hash of chain proof used
- `test_results` — Conformance test results

**Constitutional Guarantees Status:**
- `rpx_records` — §2.1 verified
- `fail_closed` — §2.2 verified
- `human_authority` — §2.3 verified
- `hash_chain` — §2.4 verified
- `context_bound` — §2.5 verified

**Issuer Roles:**
- `auditor` — Independent third-party auditor
- `certification-body` — Accredited SSI certification authority
- `regulatory-authority` — Government regulator
- `self-assessment` — Operator self-certification (lower trust)

**Usage:**
- Portable trust claims (display on website, share with customers)
- Visual badges available at `badge_url`
- Time-limited (expires after `validity_period`)
- Revocable (check `revocation_url`)
- Cryptographically signed by issuer

**Trust Model:**
- Assertions are only as trustworthy as the issuer
- Third parties verify: issuer credentials, evidence links, cryptographic signature
- Self-assessments have lower trust than independent audits

**Related Docs:**
- [COMPLIANCE.md](../COMPLIANCE.md) §4 (Certification Criteria)
- [SPEC.md](../SPEC.md) §3 (Compliance Definition)

---

## Schema Relationships

```
┌─────────────────┐
│  RPX Records    │ ◄─── Every decision produces one record
│  (hash chain)   │      (SPEC.md §2.1)
└────────┬────────┘
         │
         ├─────► Verified by ────┐
         │                        │
         │                        ▼
         │              ┌──────────────────┐
         │              │  Chain Proof     │ ◄─── ssi-verify generates
         │              │  (integrity)     │      (independent verification)
         │              └────────┬─────────┘
         │                       │
         │                       │
         ▼                       ▼
┌────────────────────┐   ┌────────────────────┐
│ Verification       │◄──┤   Compliance       │
│ Report             │   │   Assertion        │ ◄─── Portable trust badge
│ (audit findings)   │   │   (certification)  │      (time-limited, signed)
└────────────────────┘   └────────────────────┘
```

**Flow:**
1. **System generates** RPX records (hash chain)
2. **Verifier runs** `ssi-verify` → produces Chain Proof + Verification Report
3. **Auditor/Certifier** reviews report → issues Compliance Assertion
4. **Third parties** check assertion → verify issuer signature, evidence links

---

## Verification Workflow

**Step 1: Deploy SSI system**
- System produces RPX records conforming to `rpx-record.schema.json`
- Records form hash chain (each links to previous via `previous_hash`)

**Step 2: Run independent verification**
```bash
# Using ssi-verify CLI (planned v1.1.0)
ssi-verify --chain chain_prod_2025 --output verification-report.json
```

**Step 3: Review verification report**
- Auditor examines `verification-report.json`
- Checks integrity status, compliance level, tamper evidence

**Step 4: Issue compliance assertion**
- If system is compliant, auditor issues `compliance-assertion.json`
- Assertion includes evidence links, issuer signature, validity period

**Step 5: Display trust badge**
- System displays badge on website (from `badge_url`)
- Third parties verify assertion by checking:
  - Issuer credentials
  - Cryptographic signature
  - Evidence links (verification report, chain proof)
  - Validity period (not expired)

---

## Implementation Guidance

### For System Operators

**Generate RPX records:**
```json
{
  "record_id": "rec_2025-12-17_abc123",
  "timestamp": "2025-12-17T14:23:45.123456Z",
  "previous_hash": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
  "decision_type": "authorization.action",
  "agent_id": "agent-trading-001",
  "outcome": "ALLOW",
  "context_hash": "a7ffc6f8bf1ed76651c14756a061d662f580ff4de43b49fa82d80a4b80f8434a",
  "policy_version": "1.2.3",
  "record_hash": "5d41402abc4b2a76b9719d911017c592"
}
```

**Compute `record_hash`:**
1. Serialize record to canonical JSON (alphabetical keys, no whitespace, UTF-8)
2. Exclude `metadata` field
3. Compute SHA-256 hash

**Maintain hash chain:**
- Each new record's `previous_hash` = previous record's `record_hash`
- Genesis record uses known initialization hash (see [AUDIT.md](../AUDIT.md))

### For Verifiers

**Generate chain proof:**
- Read all RPX records from system
- Recompute each `record_hash` from canonical form
- Verify chain links (`previous_hash` matches prior `record_hash`)
- Detect tampering (hash mismatches, broken links)
- Output `chain-proof.json`

**Generate verification report:**
- Check constitutional guarantees (SPEC §2.1-2.5)
- Determine compliance level (L1/L2/L3 or null)
- Document findings, evidence, recommendations
- Cryptographically sign report
- Output `verification-report.json`

### For Auditors/Certifiers

**Issue compliance assertion:**
- Review verification report
- Confirm evidence (chain proof, test results)
- Determine compliance level and validity period
- Cryptographically sign assertion
- Publish badge URL for display
- Provide revocation mechanism

---

## Schema Validation

**JSON Schema validators:**
```bash
# Using ajv-cli (example)
npm install -g ajv-cli

# Validate RPX record
ajv validate -s rpx-record.schema.json -d my-record.json

# Validate verification report
ajv validate -s verification-report.schema.json -d my-report.json
```

**Schema compliance:**
- All artifacts MUST validate against their respective schemas
- Schema version embedded in `$id` field
- Breaking changes to schemas require RFC process (see [CONTRIBUTING.md](../CONTRIBUTING.md))

---

## Cryptographic Standards

**Hash Function:**
- SHA-256 (FIPS 180-4)
- 256-bit output (64 hex characters)

**Timestamp Format:**
- ISO 8601 (RFC 3339)
- UTC timezone (`Z` suffix)
- Microsecond precision: `2025-12-17T14:23:45.123456Z`

**Signature Format:**
- Implementation-specific (RSA, ECDSA, Ed25519)
- Signature must cover entire artifact (canonical JSON)
- Public key verification required

**Canonical JSON:**
- Alphabetical key order (lexicographic)
- No whitespace between tokens
- UTF-8 encoding
- No trailing newline

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0-invariant | 2025-12-17 | Initial schema release (B2 artifact schemas) |

---

## Related Documentation

**Constitutional Documents:**
- [SPEC.md](../SPEC.md) — Core invariants (§2: decision records, fail-closed, hash chain)
- [DECISIONS.md](../DECISIONS.md) — Decision type ontology
- [AUDIT.md](../AUDIT.md) — Verification procedures and hash chain rules
- [FAILURE.md](../FAILURE.md) — Fail-closed semantics
- [COMPLIANCE.md](../COMPLIANCE.md) — Three-tier compliance levels (L1/L2/L3)

**Supporting Documentation:**
- [IMPLEMENTATION.md](../IMPLEMENTATION.md) — How to run reference implementations
- [REFERENCE_IMPLEMENTATIONS.md](../REFERENCE_IMPLEMENTATIONS.md) — Kernel/Gateway descriptions

**Tooling (Planned):**
- `ssi-verify` CLI (v1.1.0, Q2 2026) — Independent verification tool
- Compliance test suite — Automated conformance testing
- Badge service — Visual compliance badges

---

## Questions?

**Schema questions:** [GitHub Discussions](https://github.com/Jtjr86/ssi-protocol-oss/discussions)  
**Verification tooling:** See [ROADMAP.md](../ROADMAP.md) for planned `ssi-verify` CLI  
**Compliance certification:** See [COMPLIANCE.md](../COMPLIANCE.md) for certification criteria

**These schemas enable independent verification.**  
**Trust becomes portable. Compliance becomes mathematical.**
