{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ssi-protocol.org/schemas/verification-report.json",
  "title": "SSI Verification Report",
  "description": "Output format for ssi-verify CLI tool. Generated by independent verifiers to attest to chain integrity, compliance status, and audit findings.",
  "type": "object",
  "required": [
    "report_id",
    "report_timestamp",
    "chain_id",
    "verification_scope",
    "integrity_status",
    "compliance_level"
  ],
  "properties": {
    "report_id": {
      "type": "string",
      "description": "Unique identifier for this verification report.",
      "pattern": "^[a-zA-Z0-9_-]{8,64}$",
      "examples": ["verify_2025-12-17_abc123"]
    },
    "report_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp (UTC) when this report was generated.",
      "examples": ["2025-12-17T15:00:00.000000Z"]
    },
    "chain_id": {
      "type": "string",
      "description": "Identifier of the hash chain being verified.",
      "examples": ["chain_prod_2025"]
    },
    "verification_scope": {
      "type": "object",
      "description": "Scope of verification performed (time range, record count, sampling method).",
      "required": ["method"],
      "properties": {
        "method": {
          "type": "string",
          "enum": ["full", "sample", "spot-check", "incremental"],
          "description": "Verification method used: full = entire chain, sample = statistical sample, spot-check = specific records, incremental = since last verification."
        },
        "start_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Start of time range for verification."
        },
        "end_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "End of time range for verification."
        },
        "record_count": {
          "type": "integer",
          "description": "Number of records verified.",
          "minimum": 0
        },
        "sample_size": {
          "type": "integer",
          "description": "If sampling, number of records in sample.",
          "minimum": 1
        }
      }
    },
    "integrity_status": {
      "type": "string",
      "description": "Overall chain integrity status. VALID = no tampering, INVALID = tampering detected, INCOMPLETE = verification could not complete.",
      "enum": ["VALID", "INVALID", "INCOMPLETE"],
      "examples": ["VALID"]
    },
    "integrity_details": {
      "type": "object",
      "description": "Detailed integrity findings.",
      "properties": {
        "total_records": {"type": "integer", "minimum": 0},
        "verified_records": {"type": "integer", "minimum": 0},
        "failed_records": {"type": "integer", "minimum": 0},
        "genesis_hash": {"type": "string", "pattern": "^[a-f0-9]{64}$"},
        "current_head": {"type": "string", "pattern": "^[a-f0-9]{64}$"},
        "chain_breaks": {
          "type": "array",
          "description": "Detected breaks in the hash chain.",
          "items": {
            "type": "object",
            "properties": {
              "record_id": {"type": "string"},
              "expected_hash": {"type": "string"},
              "actual_hash": {"type": "string"},
              "timestamp": {"type": "string", "format": "date-time"}
            }
          }
        }
      }
    },
    "compliance_level": {
      "type": "string",
      "description": "SSI compliance level as defined in COMPLIANCE.md. NULL if system is non-compliant.",
      "enum": ["L1", "L2", "L3", null],
      "examples": ["L2"]
    },
    "compliance_details": {
      "type": "object",
      "description": "Detailed compliance findings against constitutional requirements.",
      "properties": {
        "rpx_records_present": {
          "type": "boolean",
          "description": "All decisions produce RPX records (SPEC.md §2.1)"
        },
        "fail_closed_verified": {
          "type": "boolean",
          "description": "System denies on error (SPEC.md §2.2)"
        },
        "human_escalation_available": {
          "type": "boolean",
          "description": "Operator veto mechanisms present (SPEC.md §2.3)"
        },
        "hash_chain_intact": {
          "type": "boolean",
          "description": "Hash chain integrity verified (SPEC.md §2.4)"
        },
        "context_captured": {
          "type": "boolean",
          "description": "Decision context present in records (SPEC.md §2.5)"
        },
        "non_compliance_reasons": {
          "type": "array",
          "items": {"type": "string"},
          "description": "If non-compliant, reasons why."
        }
      }
    },
    "tamper_evidence": {
      "type": "array",
      "description": "Evidence of tampering if integrity_status = INVALID.",
      "items": {
        "type": "object",
        "required": ["record_id", "tampering_type"],
        "properties": {
          "record_id": {"type": "string"},
          "tampering_type": {
            "type": "string",
            "enum": ["hash-mismatch", "broken-chain", "missing-record", "timestamp-violation", "modified-content"]
          },
          "evidence": {"type": "string"},
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"]
          }
        }
      }
    },
    "verifier_identity": {
      "type": "object",
      "description": "Identity and credentials of the verifier.",
      "properties": {
        "name": {"type": "string"},
        "organization": {"type": "string"},
        "role": {"type": "string", "examples": ["independent-auditor", "regulatory-authority", "third-party-verifier"]},
        "certification": {"type": "string", "description": "Verifier's own certification/credentials"}
      }
    },
    "verifier_signature": {
      "type": "string",
      "description": "Cryptographic signature of this report by the verifier (implementation-specific format).",
      "examples": ["MEUCIQDxxx..."]
    },
    "tool_version": {
      "type": "string",
      "description": "Version of ssi-verify tool used to generate this report.",
      "examples": ["ssi-verify/1.0.0"]
    },
    "recommendations": {
      "type": "array",
      "description": "Optional: Recommendations from verifier based on findings.",
      "items": {"type": "string"}
    },
    "next_verification_due": {
      "type": "string",
      "format": "date-time",
      "description": "Optional: Recommended date for next verification."
    }
  },
  "additionalProperties": false,
  "$comment": "Verification reports are generated by ssi-verify CLI or equivalent tooling. They enable independent auditors, regulators, and third parties to attest to SSI compliance without trusting the operator."
}
